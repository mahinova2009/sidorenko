<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Форма регистрации</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #E5E5E5;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
  }

  .form-container {
    background-color: #FFFFFF;
    border-radius: 12px;
    padding: 30px 40px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 400px;
  }

  h3 {
    text-align: center;
    color: #0088CC;
    margin-bottom: 25px;
  }

  label {
    display: block;
    margin-bottom: 15px;
    font-weight: 500;
    color: #333333;
  }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  input[type="search"],
  select {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #CCCCCC;
    border-radius: 8px;
    font-size: 15px;
    transition: border-color 0.2s;
    box-sizing: border-box;
  }

  input:focus, select:focus {
    outline: none;
    border-color: #0088CC;
    box-shadow: 0 0 4px rgba(0,136,204,0.3);
  }

  button {
    width: 100%;
    padding: 12px 0;
    background-color: #0088CC;
    color: #FFFFFF;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-weight: bold;
    margin-top: 20px;
  }

  button:hover {
    background-color: #006699;
  }

  .message {
    text-align: center;
    margin-top: 15px;
    font-weight: bold;
  }

  .message.success {
    color: #008800;
  }

  .message.error {
    color: #CC0000;
  }

  .country-dropdown {
    position: relative;
  }

  .country-list {
    position: absolute;
    width: 100%;
    background: white;
    border: 1px solid #ccc;
    max-height: 150px;
    overflow-y: auto;
    border-radius: 6px;
    z-index: 10;
    display: none;
  }

  .country-list div {
    padding: 8px;
    cursor: pointer;
  }

  .country-list div:hover {
    background: #f0f0f0;
  }
</style>
</head>
<body>

<div class="form-container">
  <h3>Регистрация</h3>
  <form id="registrationForm">
    <label>ФИО
      <input type="text" name="fullName" required placeholder="Введите ваше ФИО">
    </label>
    <label>Email
      <input type="email" name="email" required placeholder="Введите ваш Email">
    </label>
    <label>Телефон
      <input type="tel" name="phone" required placeholder="Введите ваш номер">
    </label>
    <label>Дата рождения
      <input type="date" name="birthDate" required>
    </label>

    <label>Страна</label>
    <div class="country-dropdown">
      <input type="search" id="countrySearch" placeholder="Поиск страны..." autocomplete="off">
      <div id="countryList" class="country-list"></div>
    </div>

    <input type="hidden" name="country" id="countryHidden">
    <input type="hidden" name="timezone" id="timezoneHidden">

    <input type="hidden" name="chat_id" id="chat_id">

    <button type="submit">Отправить</button>
    <div id="formMessage" class="message"></div>
  </form>
</div>

<script>
const countries = [
  { name: "Молдова", offset: "0" },
  { name: "Россия (Москва)", offset: "+1" },
  { name: "Россия (Новосибирск)", offset: "+5" },
  { name: "Украина (Киев)", offset: "0" },
  { name: "Беларусь (Минск)", offset: "+1" },
  { name: "Казахстан (Алматы)", offset: "+4" },
  { name: "Грузия (Тбилиси)", offset: "+2" },
  { name: "Армения (Ереван)", offset: "+2" },
  { name: "Германия (Берлин)", offset: "-1" },
  { name: "Франция (Париж)", offset: "-1" },
  { name: "Италия (Рим)", offset: "-1" },
  { name: "Испания (Мадрид)", offset: "-1" },
  { name: "Польша (Варшава)", offset: "-1" },
  { name: "Чехия (Прага)", offset: "-1" },
  { name: "Турция (Стамбул)", offset: "+1" },
  { name: "Греция (Афины)", offset: "0" },
  { name: "США (Нью-Йорк)", offset: "-7" },
  { name: "США (Лос-Анджелес)", offset: "-10" },
  { name: "США (Чикаго)", offset: "-8" },
  { name: "США (Майами)", offset: "-7" },
  { name: "Канада (Торонто)", offset: "-7" },
  { name: "Канада (Ванкувер)", offset: "-10" },
  { name: "ОАЭ (Дубай)", offset: "+2" }
];


const searchInput = document.getElementById('countrySearch');
const listDiv = document.getElementById('countryList');
const countryHidden = document.getElementById('countryHidden');
const timezoneHidden = document.getElementById('timezoneHidden');

searchInput.addEventListener('input', () => {
  const query = searchInput.value.toLowerCase();
  listDiv.innerHTML = '';
  if (query.length > 0) {
    const filtered = countries.filter(c => c.name.toLowerCase().includes(query));
    filtered.forEach(c => {
      const div = document.createElement('div');
      div.textContent = `${c.name} (UTC${c.offset})`;
      div.addEventListener('click', () => {
        searchInput.value = c.name;
        countryHidden.value = c.name;
        timezoneHidden.value = c.offset;
        listDiv.style.display = 'none';
      });
      listDiv.appendChild(div);
    });
    listDiv.style.display = filtered.length ? 'block' : 'none';
  } else {
    listDiv.style.display = 'none';
  }
});

// chat_id из URL
const chatIdField = document.getElementById('chat_id');
const urlParams = new URLSearchParams(window.location.search);
chatIdField.value = urlParams.get('chat_id') || '';

const form = document.getElementById('registrationForm');
const formMessage = document.getElementById('formMessage');

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    formMessage.textContent = '';
    formMessage.className = 'message';

    const data = {
        fullName: form.fullName.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        birthDate: form.birthDate.value,
        country: countryHidden.value,
        timezone: timezoneHidden.value,
        chat_id: chatIdField.value
    };

    if (!data.fullName || !data.email || !data.phone || !data.birthDate || !data.country) {
        formMessage.textContent = 'Пожалуйста, заполните все поля.';
        formMessage.classList.add('error');
        return;
    }

    try {
        const webhookUrl = 'https://hook.eu2.make.com/1unspxkdfik4bgnhsvpra9m71urdffcj';

        const response = await fetch(webhookUrl, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });

        if (response.ok) {
            formMessage.textContent = 'Данные успешно отправлены! ✅ Можете закрыть форму.';
            formMessage.classList.add('success');
            form.reset();
        } else {
            const resultText = await response.text();
            formMessage.textContent = `Ошибка при отправке: ${response.status}. ${resultText}`;
            formMessage.classList.add('error');
        }
    } catch (err) {
        formMessage.textContent = 'Ошибка сети. Проверьте подключение.';
        formMessage.classList.add('error');
    }
});
</script>

</body>
</html>
