<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert</title>
<style>
  :root{
    --accent:#e75480;          
    --accent-dark:#c7436a;
    --bg:#fff0f5;
    --input:#fff;
    --text:#333;
  }
  body{
    font-family:'Segoe UI', Tahoma, sans-serif;
    background:var(--bg);
    display:flex;justify-content:center;align-items:center;
    height:100vh;margin:0;
  }
  .form-box{
    background:#fff;border-radius:12px;padding:25px 35px;
    box-shadow:0 4px 12px rgba(0,0,0,.1);
    width:100%;max-width:430px;
  }
  h2{text-align:center;color:var(--accent);margin-bottom:20px;}
  label{display:block;margin-bottom:10px;font-weight:500;color:var(--text);}
  input,select{
    width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:8px;
    font-size:15px;background:var(--input);box-sizing:border-box;
  }
  input:focus,select:focus{
    outline:none;border-color:var(--accent);box-shadow:0 0 4px rgba(231,84,128,.3);
  }
  .phone-wrapper{
    display:flex;align-items:center;gap:8px;
  }
  .country-flag{
    display:flex;align-items:center;justify-content:center;
    width:70px;padding:8px;border:1px solid #ccc;border-radius:8px;
    cursor:pointer;background:var(--input);
  }
  .country-dropdown{
    display:none;position:absolute;background:white;border:1px solid #ccc;
    max-height:150px;overflow-y:auto;z-index:10;border-radius:6px;width:80px;
  }
  .country-dropdown div{padding:6px;cursor:pointer;text-align:center;}
  .country-dropdown div:hover{background:#f0f0f0;}
  .lang-buttons{
    display:flex;justify-content:center;gap:10px;margin-bottom:15px;
  }
  .lang-buttons button{
    flex:1;padding:8px;border:1px solid var(--accent);
    background:white;color:var(--accent);font-weight:bold;
    border-radius:6px;cursor:pointer;
  }
  .lang-buttons button.active{background:var(--accent);color:white;}
  button[type=submit]{
    width:100%;padding:12px 0;background:var(--accent);
    color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:bold;
    margin-top:15px;cursor:pointer;
  }
  button[type=submit]:hover{background:var(--accent-dark);}
  .msg{margin-top:15px;text-align:center;font-weight:bold;}
  .msg.success{color:green;} .msg.error{color:darkred;}
  .hidden{display:none;}
  .checkbox-container{
    display:flex;align-items:center;margin-top:10px;font-size:14px;
  }
  .checkbox-container input{margin-right:8px;}
</style>
</head>
<body>
<div class="form-box">
  <h2 id="formTitle">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Beauty Expert</h2>
  <div class="lang-buttons">
    <button type="button" data-lang="ru" class="active">RU</button>
    <button type="button" data-lang="ro">RO</button>
    <button type="button" data-lang="en">EN</button>
  </div>
  <form id="form">
    <label id="labelName">–§–ò–û
      <input type="text" name="fullName" id="fullName" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
    </label>
    <label id="labelPhone">–¢–µ–ª–µ—Ñ–æ–Ω
      <div class="phone-wrapper">
        <div class="country-flag" id="flagSelect">üá≤üá© +373</div>
        <input type="tel" name="phone" id="phone" required placeholder="123456789">
      </div>
      <div class="country-dropdown" id="countryDropdown"></div>
    </label>
    <label id="labelEmail">Email
      <input type="email" name="email" id="email" required placeholder="mail@example.com">
    </label>
    <label id="labelBirth">–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
      <input type="date" name="birthDate" id="birthDate" required placeholder="–î–î.–ú–ú.–ì–ì–ì–ì">
    </label>
    <label id="labelRole">–¢–∏–ø —É—á–∞—Å—Ç–Ω–∏–∫–∞
      <select id="role" name="role" required>
        <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
        <option value="consultant">–ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</option>
        <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
      </select>
    </label>

    <div id="consultantsBlock" class="hidden">
      <label id="labelConsultant">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞
        <select id="consultantSelect" name="consultant">
          <option value="">--–≤—ã–±–µ—Ä–∏—Ç–µ--</option>
        </select>
      </label>
    </div>

    <div class="checkbox-container">
      <input type="checkbox" id="consent" required>
      <label for="consent" id="labelConsent">–°–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</label>
    </div>

    <input type="hidden" name="chat_id" id="chat_id">

    <button type="submit" id="submitBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <div id="msg" class="msg"></div>
  </form>
</div>

<script>
let selectedCode = "+373";

/* === –°–ø–∏—Å–æ–∫ —Å—Ç—Ä–∞–Ω === */
const countries = [
  { name:"–ú–æ–ª–¥–æ–≤–∞", code:"+373", flag:"üá≤üá©" },
  { name:"–†–æ—Å—Å–∏—è", code:"+7", flag:"üá∑üá∫" },
  { name:"–£–∫—Ä–∞–∏–Ω–∞", code:"+380", flag:"üá∫üá¶" },
  { name:"–†—É–º—ã–Ω–∏—è", code:"+40", flag:"üá∑üá¥" },
  { name:"–°–®–ê", code:"+1", flag:"üá∫üá∏" },
  { name:"–ì–µ—Ä–º–∞–Ω–∏—è", code:"+49", flag:"üá©üá™" },
  { name:"–§—Ä–∞–Ω—Ü–∏—è", code:"+33", flag:"üá´üá∑" }
];

const flagSelect=document.getElementById('flagSelect');
const dropdown=document.getElementById('countryDropdown');
flagSelect.addEventListener('click',()=>{
  dropdown.innerHTML='';
  countries.forEach(c=>{
    const div=document.createElement('div');
    div.textContent=`${c.flag} ${c.code}`;
    div.addEventListener('click',()=>{
      flagSelect.textContent=`${c.flag} ${c.code}`;
      selectedCode = c.code;
      dropdown.style.display='none';
    });
    dropdown.appendChild(div);
  });
  dropdown.style.display='block';
});

/* chat_id –∏–∑ URL */
document.getElementById('chat_id').value=new URLSearchParams(window.location.search).get('chat_id')||'';

/* –†–æ–ª—å */
const roleSel=document.getElementById('role');
const block=document.getElementById('consultantsBlock');
roleSel.addEventListener('change',()=>{
  const consultantSelect=document.getElementById('consultantSelect');
  if(roleSel.value==='client'){
    block.classList.remove('hidden');
    consultantSelect.required = true;
  }else{
    block.classList.add('hidden');
    consultantSelect.required = false;
  }
});

/* –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤ */
fetch("https://opensheet.elk.sh/10CzQHC01UjusQsFYobQ6a54zV0z__XAkxva_Ir3vDVw/Consultant")
  .then(r=>r.json())
  .then(rows=>{
    const select=document.getElementById('consultantSelect');
    rows.forEach(r=>{
      if(r["–§–ò–û"]){
        const opt=document.createElement('option');
        opt.value=r["–§–ò–û"];
        opt.textContent=r["–§–ò–û"];
        select.appendChild(opt);
      }
    });
  })
  .catch(err=>console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–≤:",err));

/* === –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ chat_id === */
async function chatIdExists(chatId) {
  try {
    const res = await fetch("https://opensheet.elk.sh/10CzQHC01UjusQsFYobQ6a54zV0z__XAkxva_Ir3vDVw/FormResponses");
    const rows = await res.json();
    return rows.some(r => r["chat_id"] === chatId);
  } catch (err) {
    console.error("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ chat_id:", err);
    return false;
  }
}

/* === –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö === */
const form=document.getElementById('form');
const msg=document.getElementById('msg');
form.addEventListener('submit',async e=>{
  e.preventDefault();

  const chatId=document.getElementById('chat_id').value.trim();
  if(!chatId){
    msg.textContent='‚ö†Ô∏è –û—à–∏–±–∫–∞: chat_id –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';
    msg.className='msg error';
    return;
  }

  if(!document.getElementById('consent').checked){
    msg.textContent='‚òùÔ∏è –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö';
    msg.className='msg error';
    return;
  }

  const exists = await chatIdExists(chatId);
  if (exists) {
    msg.textContent = '‚ö†Ô∏è –í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã.';
    msg.className = 'msg error';
    return;
  }

  const data={
    fullName:form.fullName.value.trim(),
    phone:selectedCode + form.phone.value.trim(),
    email:form.email.value.trim(),
    birthDate:form.birthDate.value,
    role:roleSel.value,
    consultant: document.getElementById('consultantSelect').value || null,
    chat_id: chatId
  };

  try{
    const res=await fetch('https://hook.eu2.make.com/9h9m39efm8lp2sen3fm6y6rm74rrc73n',{
      method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)
    });
    if(res.ok){
      msg.textContent='‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã!';
      msg.className='msg success';
      form.reset();
    }else{
      msg.textContent='‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏';
      msg.className='msg error';
    }
  }catch(err){
    msg.textContent='‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏';
    msg.className='msg error';
  }
});
</script>
</body>
</html>
