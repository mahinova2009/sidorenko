<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Форма регистрации</title>
<style>
  :root{
    --blue:#0088CC;
    --blue-dark:#006699;
    --muted:#f2f6f8;
    --gap:14px;
  }

  *{box-sizing:border-box;font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;}

  body{
    margin:0;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#E5E5E5;
    padding:20px;
  }

  .form-container{
    width:100%;
    max-width:420px;
    background:#fff;
    border-radius:12px;
    padding:26px;
    box-shadow:0 6px 20px rgba(0,0,0,0.08);
  }

  h3{
    text-align:center;
    color:var(--blue);
    margin:0 0 12px;
    font-size:20px;
  }

  .lang-switch{
    display:flex;
    gap:8px;
    justify-content:center;
    margin-bottom: var(--gap);
  }

  .lang-switch button{
    width:46px;height:36px;border-radius:6px;border:1px solid #d0d7db;
    background:#fff; color:var(--blue); cursor:pointer;
    font-weight:700;
  }
  .lang-switch button.active{
    background:var(--blue); color:#fff; border-color:var(--blue);
  }

  form{
    display:flex;
    flex-direction:column;
  }

  .field{
    margin-bottom:var(--gap);
    position:relative;
  }

  label.visually-hidden{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }

  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  input[type="search"]{
    width:100%;
    padding:11px 12px;
    border-radius:8px;
    border:1px solid #d8dbe0;
    font-size:15px;
    background:#fff;
    transition:box-shadow .12s, border-color .12s;
  }
  input:focus{ outline:none; border-color:var(--blue); box-shadow:0 0 6px rgba(0,136,204,0.12); }

  /* Country dropdown */
  .country-dropdown { position:relative; }
  #countrySearch{ cursor:text; }
  .country-list{
    position:absolute;
    left:0; right:0;
    top:calc(100% + 6px);
    background:#fff;
    border:1px solid #e0e3e6;
    border-radius:8px;
    max-height:220px;
    overflow:auto;
    z-index:30;
    box-shadow:0 10px 24px rgba(0,0,0,0.06);
    display:none;
  }
  .country-item{
    padding:10px 12px;
    cursor:pointer;
    font-size:14px;
    color:#222;
  }
  .country-item:hover, .country-item.active{
    background:#f5fbff;
  }

  .consent{
    display:flex;
    gap:10px;
    align-items:flex-start;
    margin-bottom:12px;
  }
  .consent label{ font-size:14px; color:#333; margin:0; }

  button[type="submit"]{
    border:0;
    background:var(--blue);
    color:#fff;
    padding:12px 14px;
    border-radius:8px;
    font-weight:700;
    cursor:pointer;
    transition:background .12s;
  }
  button[type="submit"]:hover{ background:var(--blue-dark); }

  .message{ text-align:center; margin-top:12px; font-weight:700; }
  .message.success{ color: #0a8a3f; }
  .message.error{ color:#cc2b2b; }

  /* equal spacing fix for date input small browsers */
  input[type="date"]::-webkit-datetime-edit { padding:8px 0; }

  /* small screens */
  @media (max-width:420px){ .form-container{padding:18px;} .lang-switch button{width:40px;height:34px;} }
</style>
</head>
<body>

<div class="form-container" role="form" aria-label="Registration form">
  <h3 id="formTitle">Регистрация</h3>

  <div class="lang-switch" role="tablist" aria-label="Language switch">
    <button type="button" data-lang="ru" class="active" aria-pressed="true">RU</button>
    <button type="button" data-lang="ro" aria-pressed="false">RO</button>
    <button type="button" data-lang="en" aria-pressed="false">EN</button>
  </div>

  <form id="registrationForm" autocomplete="on" novalidate>
    <!-- COUNTRY (search + dropdown) -->
    <div class="field country-dropdown">
      <label class="visually-hidden" for="countrySearch">Страна</label>
      <input id="countrySearch" name="countrySearch" type="search" placeholder="Поиск страны..." autocomplete="off" />
      <div id="countryList" class="country-list" role="listbox" aria-label="Country list"></div>
      <!-- hidden values -->
      <input type="hidden" id="countryHidden" name="country">
      <input type="hidden" id="timezoneHidden" name="timezone">
      <input type="hidden" id="countryCodeHidden" name="country_code">
    </div>

    <!-- PHONE -->
    <div class="field">
      <label class="visually-hidden" for="phoneInput">Телефон</label>
      <input id="phoneInput" name="phone" type="tel" placeholder="Введите номер телефона" />
    </div>

    <!-- FULL NAME -->
    <div class="field">
      <label class="visually-hidden" for="fullNameInput">ФИО</label>
      <input id="fullNameInput" name="fullName" type="text" placeholder="Введите ваше ФИО" />
    </div>

    <!-- EMAIL -->
    <div class="field">
      <label class="visually-hidden" for="emailInput">Email</label>
      <input id="emailInput" name="email" type="email" placeholder="Введите ваш Email" />
    </div>

    <!-- BIRTHDATE -->
    <div class="field">
      <label class="visually-hidden" for="birthDateInput">Дата рождения</label>
      <input id="birthDateInput" name="birthDate" type="date" />
    </div>

    <!-- CONSENT -->
    <div class="consent">
      <input id="consentCheckbox" name="consent" type="checkbox" />
      <label id="consentLabel" for="consentCheckbox">Я согласен на обработку персональных данных</label>
    </div>

    <!-- hidden chat_id -->
    <input type="hidden" id="chat_id" name="chat_id" />

    <button type="submit" id="submitBtn">Отправить</button>
    <div id="formMessage" class="message" aria-live="polite"></div>
  </form>
</div>

<script>
/* --------- countries dataset (names in RU/EN/RO variants, timezone offset relative to Chisinau (UTC+2), and phone code) --------- */
const countries = [
  { names:["Молдова","Moldova","Republica Moldova"], offset: 0, code:"+373" },
  { names:["Россия","Russia","Rus"], offset: 1, code:"+7" },
  { names:["Украина","Ukraine","Ucraina","Ukraina (Kyiv)"], offset: 0, code:"+380" },
  { names:["Румыния","Romania","România"], offset: 0, code:"+40" },
  { names:["Греция","Greece","Grecia"], offset: 0, code:"+30" },
  { names:["Турция","Turkey","Turcia"], offset: 1, code:"+90" },
  { names:["Германия","Germany","Germania"], offset:-1, code:"+49" },
  { names:["Франция","France","Franța"], offset:-1, code:"+33" },
  { names:["Италия","Italy","Italia"], offset:-1, code:"+39" },
  { names:["Испания","Spain","Spania"], offset:-1, code:"+34" },
  { names:["Польша","Poland","Polonia"], offset:-1, code:"+48" },
  { names:["Чехия","Czechia","Cehia"], offset:-1, code:"+420" },
  { names:["США","USA","United States","Statele Unite"], offset:-7, code:"+1" },
  { names:["Канада","Canada"], offset:-7, code:"+1" },
  { names:["ОАЭ","UAE","United Arab Emirates","الإمارات"], offset:2, code:"+971" }
];

/* --------- translations --------- */
const translations = {
  ru: {
    formTitle: "Регистрация",
    place_country: "Поиск страны...",
    place_phone: "Введите номер телефона",
    place_fullname: "Введите ваше ФИО",
    place_email: "Введите ваш Email",
    place_birth: "Дата рождения",
    consent: "Я согласен на обработку персональных данных",
    submit: "Отправить",
    success: "Данные успешно отправлены! ✅",
    fill_all: "Пожалуйста, заполните все поля и подтвердите согласие."
  },
  ro: {
    formTitle: "Înregistrare",
    place_country: "Căutați țara...",
    place_phone: "Introduceți numărul de telefon",
    place_fullname: "Introduceți numele complet",
    place_email: "Introduceți emailul",
    place_birth: "Data nașterii",
    consent: "Sunt de acord cu prelucrarea datelor personale",
    submit: "Trimite",
    success: "Datele au fost trimise cu succes! ✅",
    fill_all: "Vă rugăm să completați toate câmpurile și să confirmați consimțământul."
  },
  en: {
    formTitle: "Registration",
    place_country: "Search country...",
    place_phone: "Enter your phone number",
    place_fullname: "Enter your full name",
    place_email: "Enter your email",
    place_birth: "Date of birth",
    consent: "I agree to the processing of personal data",
    submit: "Submit",
    success: "Data sent successfully! ✅",
    fill_all: "Please fill in all fields and confirm consent."
  }
};

/* --------- DOM elements --------- */
const countrySearch = document.getElementById('countrySearch');
const countryList = document.getElementById('countryList');
const countryHidden = document.getElementById('countryHidden');
const timezoneHidden = document.getElementById('timezoneHidden');
const countryCodeHidden = document.getElementById('countryCodeHidden');
const phoneInput = document.getElementById('phoneInput');
const consentCheckbox = document.getElementById('consentCheckbox');
const form = document.getElementById('registrationForm');
const formMessage = document.getElementById('formMessage');
const currentLangBtn = document.querySelector('.lang-switch button.active');

let currentLang = currentLangBtn ? currentLangBtn.dataset.lang : 'ru';
let selectedIndex = -1; // for keyboard navigation

/* --------- helper functions --------- */
function setPlaceholders(lang){
  const t = translations[lang];
  document.getElementById('formTitle').textContent = t.formTitle;
  countrySearch.placeholder = t.place_country;
  phoneInput.placeholder = t.place_phone;
  document.getElementById('fullNameInput').placeholder = t.place_fullname;
  document.getElementById('emailInput').placeholder = t.place_email;
  document.getElementById('birthDateInput').placeholder = t.place_birth;
  document.getElementById('consentLabel').textContent = t.consent;
  document.getElementById('submitBtn').textContent = t.submit;
}

/* build country list matching function: matches query against all aliases (case-insensitive) */
function findMatches(query){
  if (!query) return countries.slice(0, 40); // show top list if empty (limited)
  const q = query.trim().toLowerCase();
  return countries.filter(c => c.names.some(n => n.toLowerCase().includes(q)));
}

/* render dropdown */
function renderList(items){
  countryList.innerHTML = '';
  if (!items.length){ countryList.style.display = 'none'; return; }
  items.forEach((c, idx) => {
    const div = document.createElement('div');
    div.className = 'country-item';
    div.tabIndex = -1;
    div.dataset.index = idx;
    div.innerHTML = `<strong>${c.names[0]}</strong> — ${c.code} <span style="color:#666; margin-left:8px; font-size:13px">UTC ${(c.offset>=0?"+":"") + c.offset}</span>`;
    div.addEventListener('mousedown', (ev)=>{ // mousedown so selection before blur
      ev.preventDefault();
      chooseCountry(c);
    });
    countryList.appendChild(div);
  });
  countryList.style.display = 'block';
}

/* choose a country object -> populate hidden fields and phone code */
function chooseCountry(c){
  countrySearch.value = c.names[0];
  countryHidden.value = c.names[0];
  timezoneHidden.value = String(c.offset);
  countryCodeHidden.value = c.code;
  // set phone prefix only if input empty or doesn't already start with + 
  if (!phoneInput.value || phoneInput.value.trim() === '' || !phoneInput.value.trim().startsWith('+')) {
    phoneInput.value = c.code + ' ';
  }
  countryList.style.display = 'none';
}

/* keyboard navigation inside country list */
function highlightIndex(i){
  const items = countryList.querySelectorAll('.country-item');
  items.forEach((el, idx)=>el.classList.toggle('active', idx===i));
  selectedIndex = i;
}

/* clear selection */
function clearSelection(){
  countryHidden.value = '';
  timezoneHidden.value = '';
  countryCodeHidden.value = '';
}

/* --------- event listeners --------- */
/* show list on focus, and filter while typing */
countrySearch.addEventListener('focus', ()=> {
  renderList(findMatches(countrySearch.value));
});
countrySearch.addEventListener('input', ()=> {
  selectedIndex = -1;
  renderList(findMatches(countrySearch.value));
});
countrySearch.addEventListener('keydown', (e)=>{
  const items = countryList.querySelectorAll('.country-item');
  if (!items.length) return;
  if (e.key === 'ArrowDown'){ e.preventDefault(); let next = Math.min(items.length-1, selectedIndex+1); highlightIndex(next); items[next].scrollIntoView({block:'nearest'}); }
  else if (e.key === 'ArrowUp'){ e.preventDefault(); let prev = Math.max(0, selectedIndex-1); highlightIndex(prev); items[prev].scrollIntoView({block:'nearest'}); }
  else if (e.key === 'Enter'){ e.preventDefault(); if (selectedIndex>=0 && items[selectedIndex]) { items[selectedIndex].dispatchEvent(new MouseEvent('mousedown')); } else { // try to match exact by typed
      const q = countrySearch.value.trim().toLowerCase();
      const exact = countries.find(c => c.names.some(n=>n.toLowerCase()===q));
      if (exact) chooseCountry(exact);
    }
  }
});

/* hide list on blur with a small delay to allow click */
countrySearch.addEventListener('blur', ()=> {
  setTimeout(()=>{ countryList.style.display = 'none'; }, 160);
});

/* global click outside -> hide */
document.addEventListener('click', (e)=>{
  if (!e.composedPath().includes(countryList) && e.target !== countrySearch){
    countryList.style.display = 'none';
  }
});

/* language switch */
document.querySelectorAll('.lang-switch button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.lang-switch button').forEach(b=>{ b.classList.remove('active'); b.setAttribute('aria-pressed','false'); });
    btn.classList.add('active'); btn.setAttribute('aria-pressed','true');
    currentLang = btn.dataset.lang;
    setPlaceholders(currentLang);
  });
});

/* set chat_id from URL if provided */
(function setChatIdFromUrl(){
  const params = new URLSearchParams(window.location.search);
  const chatId = params.get('chat_id') || '';
  document.getElementById('chat_id').value = chatId;
})();

/* submit handler: simple validation and POST to webhook */
form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  formMessage.textContent = '';
  formMessage.className = 'message';

  // validation
  const country = countryHidden.value.trim();
  const phone = phoneInput.value.trim();
  const fullName = document.getElementById('fullNameInput').value.trim();
  const email = document.getElementById('emailInput').value.trim();
  const birthDate = document.getElementById('birthDateInput').value;
  const consent = consentCheckbox.checked;
  const timezone = timezoneHidden.value;
  const countryCode = countryCodeHidden.value;
  const chatId = document.getElementById('chat_id').value;

  if (!country || !phone || !fullName || !email || !birthDate || !consent){
    formMessage.textContent = translations[currentLang].fill_all;
    formMessage.classList.add('error');
    return;
  }

  const payload = { country, phone, fullName, email, birthDate, timezone, country_code:countryCode, chat_id:chatId };

  try {
    // <-- Вставь сюда свой webhook URL -->
    const webhookUrl = 'https://hook.eu2.make.com/1unspxkdfik4bgnhsvpra9m71urdffcj';

    const resp = await fetch(webhookUrl, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });

    if (resp.ok){
      formMessage.textContent = translations[currentLang].success;
      formMessage.classList.add('success');
      form.reset();
      clearSelection();
    } else {
      const txt = await resp.text();
      formMessage.textContent = 'Ошибка отправки: ' + resp.status + ' ' + txt;
      formMessage.classList.add('error');
    }
  } catch(err){
    formMessage.textContent = 'Ошибка сети. Попробуйте позже.';
    formMessage.classList.add('error');
  }
});

/* initial placeholders */
setPlaceholders(currentLang);
</script>

</body>
</html>
